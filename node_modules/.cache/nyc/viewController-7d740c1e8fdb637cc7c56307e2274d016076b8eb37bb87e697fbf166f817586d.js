function cov_6fvav61cs(){var path="/home/teja/saiteja/minor_pro/controller/viewController.js";var hash="b2ce536e18e75ceca2bd0b820497f52393e6bbd7";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/teja/saiteja/minor_pro/controller/viewController.js",statementMap:{"0":{start:{line:1,column:24},end:{line:1,column:53}},"1":{start:{line:2,column:11},end:{line:2,column:34}},"2":{start:{line:5,column:4},end:{line:34,column:5}},"3":{start:{line:6,column:23},end:{line:6,column:50}},"4":{start:{line:7,column:19},end:{line:7,column:47}},"5":{start:{line:8,column:32},end:{line:8,column:101}},"6":{start:{line:9,column:8},end:{line:9,column:29}},"7":{start:{line:10,column:8},end:{line:12,column:9}},"8":{start:{line:11,column:12},end:{line:11,column:55}},"9":{start:{line:13,column:30},end:{line:27,column:10}},"10":{start:{line:14,column:12},end:{line:26,column:13}},"11":{start:{line:15,column:31},end:{line:18,column:17}},"12":{start:{line:19,column:29},end:{line:19,column:65}},"13":{start:{line:20,column:16},end:{line:23,column:18}},"14":{start:{line:25,column:16},end:{line:25,column:31}},"15":{start:{line:28,column:23},end:{line:28,column:55}},"16":{start:{line:29,column:8},end:{line:29,column:57}},"17":{start:{line:32,column:8},end:{line:32,column:53}},"18":{start:{line:38,column:0},end:{line:38,column:40}}},fnMap:{"0":{name:"getPendingRequests",decl:{start:{line:4,column:15},end:{line:4,column:33}},loc:{start:{line:4,column:44},end:{line:35,column:1}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:13,column:50},end:{line:13,column:51}},loc:{start:{line:13,column:69},end:{line:27,column:9}},line:13}},branchMap:{"0":{loc:{start:{line:10,column:8},end:{line:12,column:9}},type:"if",locations:[{start:{line:10,column:8},end:{line:12,column:9}},{start:{line:10,column:8},end:{line:12,column:9}}],line:10},"1":{loc:{start:{line:14,column:12},end:{line:26,column:13}},type:"if",locations:[{start:{line:14,column:12},end:{line:26,column:13}},{start:{line:14,column:12},end:{line:26,column:13}}],line:14}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"b2ce536e18e75ceca2bd0b820497f52393e6bbd7"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_6fvav61cs=function(){return actualCoverage;};}return actualCoverage;}cov_6fvav61cs();const{mongoClient}=(cov_6fvav61cs().s[0]++,require('../config/database'));const s3=(cov_6fvav61cs().s[1]++,require('../config/s3'));async function getPendingRequests(req,res){cov_6fvav61cs().f[0]++;cov_6fvav61cs().s[2]++;try{const client=(cov_6fvav61cs().s[3]++,await mongoClient.connect());const db=(cov_6fvav61cs().s[4]++,client.db('facerecognition'));const pendingRequests=(cov_6fvav61cs().s[5]++,await db.collection('reg_req').find({request:'pending'}).toArray());cov_6fvav61cs().s[6]++;await client.close();cov_6fvav61cs().s[7]++;if(pendingRequests.length==0){cov_6fvav61cs().b[0][0]++;cov_6fvav61cs().s[8]++;res.status(202).send("no pending requests");}else{cov_6fvav61cs().b[0][1]++;}const imagePromises=(cov_6fvav61cs().s[9]++,pendingRequests.map(async request=>{cov_6fvav61cs().f[1]++;cov_6fvav61cs().s[10]++;if(request.imageUrl){cov_6fvav61cs().b[1][0]++;const params=(cov_6fvav61cs().s[11]++,{Bucket:'faces-samp',Key:request.imageUrl.split('/').slice(-2).join('/')// Extracting key from imageUrl
});const data=(cov_6fvav61cs().s[12]++,await s3.getObject(params).promise());cov_6fvav61cs().s[13]++;return{...request,image:data.Body.toString('base64')// Convert image data to base64 string
};}else{cov_6fvav61cs().b[1][1]++;cov_6fvav61cs().s[14]++;return request;// Return request as it is if imageUrl is not defined
}}));const images=(cov_6fvav61cs().s[15]++,await Promise.all(imagePromises));cov_6fvav61cs().s[16]++;res.status(200).send({pendingRequests:images});}catch(error){cov_6fvav61cs().s[17]++;//console.error('Error:', error);
res.status(500).send("Internal server error");//res.status(500).json({ success: true, message: 'Internal server error' });
}}cov_6fvav61cs().s[18]++;module.exports={getPendingRequests};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfNmZ2YXY2MWNzIiwiYWN0dWFsQ292ZXJhZ2UiLCJtb25nb0NsaWVudCIsInMiLCJyZXF1aXJlIiwiczMiLCJnZXRQZW5kaW5nUmVxdWVzdHMiLCJyZXEiLCJyZXMiLCJmIiwiY2xpZW50IiwiY29ubmVjdCIsImRiIiwicGVuZGluZ1JlcXVlc3RzIiwiY29sbGVjdGlvbiIsImZpbmQiLCJyZXF1ZXN0IiwidG9BcnJheSIsImNsb3NlIiwibGVuZ3RoIiwiYiIsInN0YXR1cyIsInNlbmQiLCJpbWFnZVByb21pc2VzIiwibWFwIiwiaW1hZ2VVcmwiLCJwYXJhbXMiLCJCdWNrZXQiLCJLZXkiLCJzcGxpdCIsInNsaWNlIiwiam9pbiIsImRhdGEiLCJnZXRPYmplY3QiLCJwcm9taXNlIiwiaW1hZ2UiLCJCb2R5IiwidG9TdHJpbmciLCJpbWFnZXMiLCJQcm9taXNlIiwiYWxsIiwiZXJyb3IiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsidmlld0NvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBtb25nb0NsaWVudCB9ID0gcmVxdWlyZSgnLi4vY29uZmlnL2RhdGFiYXNlJyk7XG5jb25zdCBzMyA9IHJlcXVpcmUoJy4uL2NvbmZpZy9zMycpO1xuXG5hc3luYyBmdW5jdGlvbiBnZXRQZW5kaW5nUmVxdWVzdHMocmVxLCByZXMpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBtb25nb0NsaWVudC5jb25uZWN0KCk7XG4gICAgICAgIGNvbnN0IGRiID0gY2xpZW50LmRiKCdmYWNlcmVjb2duaXRpb24nKTtcbiAgICAgICAgY29uc3QgcGVuZGluZ1JlcXVlc3RzID0gYXdhaXQgZGIuY29sbGVjdGlvbigncmVnX3JlcScpLmZpbmQoeyByZXF1ZXN0OiAncGVuZGluZycgfSkudG9BcnJheSgpO1xuICAgICAgICBhd2FpdCBjbGllbnQuY2xvc2UoKTtcbiAgICAgICAgaWYocGVuZGluZ1JlcXVlc3RzLmxlbmd0aD09MCl7XG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwMikuc2VuZChcIm5vIHBlbmRpbmcgcmVxdWVzdHNcIilcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpbWFnZVByb21pc2VzID0gcGVuZGluZ1JlcXVlc3RzLm1hcChhc3luYyAocmVxdWVzdCkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlcXVlc3QuaW1hZ2VVcmwpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIEJ1Y2tldDogJ2ZhY2VzLXNhbXAnLFxuICAgICAgICAgICAgICAgICAgICBLZXk6IHJlcXVlc3QuaW1hZ2VVcmwuc3BsaXQoJy8nKS5zbGljZSgtMikuam9pbignLycpLCAvLyBFeHRyYWN0aW5nIGtleSBmcm9tIGltYWdlVXJsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgczMuZ2V0T2JqZWN0KHBhcmFtcykucHJvbWlzZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnJlcXVlc3QsXG4gICAgICAgICAgICAgICAgICAgIGltYWdlOiBkYXRhLkJvZHkudG9TdHJpbmcoJ2Jhc2U2NCcpLCAvLyBDb252ZXJ0IGltYWdlIGRhdGEgdG8gYmFzZTY0IHN0cmluZ1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXF1ZXN0OyAvLyBSZXR1cm4gcmVxdWVzdCBhcyBpdCBpcyBpZiBpbWFnZVVybCBpcyBub3QgZGVmaW5lZFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgaW1hZ2VzID0gYXdhaXQgUHJvbWlzZS5hbGwoaW1hZ2VQcm9taXNlcyk7XG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHsgcGVuZGluZ1JlcXVlc3RzOiBpbWFnZXMgfSlcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvL2NvbnNvbGUuZXJyb3IoJ0Vycm9yOicsIGVycm9yKTtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoXCJJbnRlcm5hbCBzZXJ2ZXIgZXJyb3JcIilcbiAgICAgICAgLy9yZXMuc3RhdHVzKDUwMCkuanNvbih7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0pO1xuICAgIH1cbn1cblxuXG5tb2R1bGUuZXhwb3J0cyA9IHsgZ2V0UGVuZGluZ1JlcXVlc3RzIH07XG4iXSwibWFwcGluZ3MiOiI0N0VBZVk7QUFBQUEsYUFBQSxTQUFBQSxDQUFBLFNBQUFDLGNBQUEsV0FBQUEsY0FBQSxFQUFBRCxhQUFBLEdBZlosS0FBTSxDQUFFRSxXQUFZLENBQUMsRUFBQUYsYUFBQSxHQUFBRyxDQUFBLE1BQUdDLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxFQUNyRCxLQUFNLENBQUFDLEVBQUUsRUFBQUwsYUFBQSxHQUFBRyxDQUFBLE1BQUdDLE9BQU8sQ0FBQyxjQUFjLENBQUMsRUFFbEMsY0FBZSxDQUFBRSxrQkFBa0JBLENBQUNDLEdBQUcsQ0FBRUMsR0FBRyxDQUFFLENBQUFSLGFBQUEsR0FBQVMsQ0FBQSxNQUFBVCxhQUFBLEdBQUFHLENBQUEsTUFDeEMsR0FBSSxDQUNBLEtBQU0sQ0FBQU8sTUFBTSxFQUFBVixhQUFBLEdBQUFHLENBQUEsTUFBRyxLQUFNLENBQUFELFdBQVcsQ0FBQ1MsT0FBTyxDQUFDLENBQUMsRUFDMUMsS0FBTSxDQUFBQyxFQUFFLEVBQUFaLGFBQUEsR0FBQUcsQ0FBQSxNQUFHTyxNQUFNLENBQUNFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUN2QyxLQUFNLENBQUFDLGVBQWUsRUFBQWIsYUFBQSxHQUFBRyxDQUFBLE1BQUcsS0FBTSxDQUFBUyxFQUFFLENBQUNFLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLENBQUVDLE9BQU8sQ0FBRSxTQUFVLENBQUMsQ0FBQyxDQUFDQyxPQUFPLENBQUMsQ0FBQyxFQUFDakIsYUFBQSxHQUFBRyxDQUFBLE1BQzlGLEtBQU0sQ0FBQU8sTUFBTSxDQUFDUSxLQUFLLENBQUMsQ0FBQyxDQUFDbEIsYUFBQSxHQUFBRyxDQUFBLE1BQ3JCLEdBQUdVLGVBQWUsQ0FBQ00sTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFBbkIsYUFBQSxHQUFBb0IsQ0FBQSxTQUFBcEIsYUFBQSxHQUFBRyxDQUFBLE1BQ3pCSyxHQUFHLENBQUNhLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQy9DLENBQUMsS0FBQXRCLGFBQUEsR0FBQW9CLENBQUEsVUFDRCxLQUFNLENBQUFHLGFBQWEsRUFBQXZCLGFBQUEsR0FBQUcsQ0FBQSxNQUFHVSxlQUFlLENBQUNXLEdBQUcsQ0FBQyxLQUFPLENBQUFSLE9BQU8sRUFBSyxDQUFBaEIsYUFBQSxHQUFBUyxDQUFBLE1BQUFULGFBQUEsR0FBQUcsQ0FBQSxPQUN6RCxHQUFJYSxPQUFPLENBQUNTLFFBQVEsQ0FBRSxDQUFBekIsYUFBQSxHQUFBb0IsQ0FBQSxTQUNsQixLQUFNLENBQUFNLE1BQU0sRUFBQTFCLGFBQUEsR0FBQUcsQ0FBQSxPQUFHLENBQ1h3QixNQUFNLENBQUUsWUFBWSxDQUNwQkMsR0FBRyxDQUFFWixPQUFPLENBQUNTLFFBQVEsQ0FBQ0ksS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEdBQUcsQ0FBRztBQUMxRCxDQUFDLEVBQ0QsS0FBTSxDQUFBQyxJQUFJLEVBQUFoQyxhQUFBLEdBQUFHLENBQUEsT0FBRyxLQUFNLENBQUFFLEVBQUUsQ0FBQzRCLFNBQVMsQ0FBQ1AsTUFBTSxDQUFDLENBQUNRLE9BQU8sQ0FBQyxDQUFDLEVBQUNsQyxhQUFBLEdBQUFHLENBQUEsT0FDbEQsTUFBTyxDQUNILEdBQUdhLE9BQU8sQ0FDVm1CLEtBQUssQ0FBRUgsSUFBSSxDQUFDSSxJQUFJLENBQUNDLFFBQVEsQ0FBQyxRQUFRLENBQUc7QUFDekMsQ0FBQyxDQUNMLENBQUMsSUFBTSxDQUFBckMsYUFBQSxHQUFBb0IsQ0FBQSxTQUFBcEIsYUFBQSxHQUFBRyxDQUFBLE9BQ0gsTUFBTyxDQUFBYSxPQUFPLENBQUU7QUFDcEIsQ0FDSixDQUFDLENBQUMsRUFDRixLQUFNLENBQUFzQixNQUFNLEVBQUF0QyxhQUFBLEdBQUFHLENBQUEsT0FBRyxLQUFNLENBQUFvQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ2pCLGFBQWEsQ0FBQyxFQUFDdkIsYUFBQSxHQUFBRyxDQUFBLE9BQ2hESyxHQUFHLENBQUNhLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLENBQUVULGVBQWUsQ0FBRXlCLE1BQU8sQ0FBQyxDQUFDLENBQ3JELENBQUUsTUFBT0csS0FBSyxDQUFFLENBQUF6QyxhQUFBLEdBQUFHLENBQUEsT0FDWjtBQUNBSyxHQUFHLENBQUNhLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQzdDO0FBQ0osQ0FDSixDQUFDdEIsYUFBQSxHQUFBRyxDQUFBLE9BR0R1QyxNQUFNLENBQUNDLE9BQU8sQ0FBRyxDQUFFckMsa0JBQW1CLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=